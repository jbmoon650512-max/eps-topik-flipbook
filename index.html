<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPS-TOPIK E-Book Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        body { margin: 0; background-color: #2d3436; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        #toolbar {
            width: 100%; height: 50px; background: #1a1a1a; display: flex; justify-content: center; align-items: center; gap: 20px;
            color: white; font-family: sans-serif; font-weight: bold; border-bottom: 1px solid #444;
        }
        button {
            background: #444; border: none; color: white; padding: 8px 16px; border-radius: 4px; cursor: pointer; transition: 0.2s;
        }
        button:hover { background: #666; }
        #viewer-container {
            flex: 1; width: 100%; overflow-y: auto; display: flex; justify-content: center; background: #525659; position: relative;
        }
        canvas { box-shadow: 0 5px 15px rgba(0,0,0,0.5); margin: 20px 0; }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #2d3436; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="toolbar">
        <button id="prev">◀ Prev</button>
        <span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>
        <button id="next">Next ▶</button>
    </div>
    <div id="viewer-container">
        <canvas id="the-canvas"></canvas>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const file = urlParams.get('file'); 
        
        if (!file) { 
            document.body.innerHTML = "<h2 style='color:white; text-align:center; margin-top:50px;'>File not found</h2>"; 
        } else {
            var pdfDoc = null, pageNum = 1, pageRendering = false, pageNumPending = null, scale = 1.2, canvas = document.getElementById('the-canvas'), ctx = canvas.getContext('2d');
            var url = file; 
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

            function renderPage(num) {
                pageRendering = true;
                pdfDoc.getPage(num).then(function(page) {
                    var viewport = page.getViewport({scale: scale});
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    var renderContext = { canvasContext: ctx, viewport: viewport };
                    var renderTask = page.render(renderContext);
                    renderTask.promise.then(function() {
                        pageRendering = false;
                        if (pageNumPending !== null) { renderPage(pageNumPending); pageNumPending = null; }
                    });
                });
                document.getElementById('page_num').textContent = num;
            }
            function queueRenderPage(num) { if (pageRendering) { pageNumPending = num; } else { renderPage(num); } }
            function onPrevPage() { if (pageNum <= 1) return; pageNum--; queueRenderPage(pageNum); }
            document.getElementById('prev').addEventListener('click', onPrevPage);
            function onNextPage() { if (pageNum >= pdfDoc.numPages) return; pageNum++; queueRenderPage(pageNum); }
            document.getElementById('next').addEventListener('click', onNextPage);
            pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page_count').textContent = pdfDoc.numPages;
                renderPage(pageNum);
            });
        }
    </script>
</body>
</html>
